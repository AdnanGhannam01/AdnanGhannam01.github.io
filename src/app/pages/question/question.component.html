<div class="container" *ngIf="question">
    <div class="question__card question">
        <div class="question__votes">
            <p-button icon="pi pi-angle-up" 
                [disabled]="!isLoggedIn"
                styleClass="p-button-rounded p-button-primary p-button-text"
            ></p-button>
            <!-- TODO fix this -->
            <strong>10</strong>
            <p-button icon="pi pi-angle-down" 
                [disabled]="!isLoggedIn"
                styleClass="p-button-rounded p-button-danger p-button-text"
            ></p-button>
        </div>
        <div class="question__content">
            <div class="question__header">
                <div>
                    <h3>Q: 
                        <span *ngIf="!editingQuestion">{{ question.title }}</span>
                        <span *ngIf="editingQuestion">
                            <input pInputText [(ngModel)]="question.title"/>
                        </span>
                    </h3>
                    <small>Posted by {{ question.user.name }} at {{ question.createdAt | date:'dd/MM/yyyy' }} | {{ question.answers.length }} Answers</small>
                </div>
                <div *ngIf="isOwner(question.user._id)">
                    <p-button
                        *ngIf="!editingQuestion"
                        (onClick)="editingQuestion = true"
                        icon="pi pi-pencil"
                        styleClass="p-button-primary p-button-text"
                    ></p-button>
                    <p-button
                        *ngIf="editingQuestion"
                        (onClick)="editQuestion()"
                        icon="pi pi-check"
                        styleClass="p-button-primary p-button-text"
                    ></p-button>
                    <p-button
                        (onClick)="deleteQuestion()"
                        icon="pi pi-trash"
                        styleClass="p-button-danger p-button-text"
                    ></p-button>
                </div>
            </div>
            <p-divider></p-divider>
            <p *ngIf="!editingQuestion" class="question__content__text" [innerHTML]="question.content"></p>
            <p-editor #editor *ngIf="editingQuestion" [(ngModel)]="question.content" [style]="{ height: '320px' }"></p-editor>
        </div>
    </div>

    <p-dataView [value]="question.answers" [sortField]="sortField" [sortOrder]="sortOrder" emptyMessage="No answers yet!">
        <ng-template pTemplate="header">
            <div class="p-dataview-header--flex">
                <h4>Answers ({{ question.answers.length }})</h4>
                <p-dropdown [disabled]="question.answers.length == 0" [options]="sortOptions" placeholder="Sort By Votes" (onChange)="onSortChange($event)"></p-dropdown>
            </div>
        </ng-template>
        <ng-template let-answer let-index="rowIndex" pTemplate="listItem">
            <div class="question__card">
                <div class="question__votes">
                    <p-button icon="pi pi-angle-up" 
                        [disabled]="!isLoggedIn"
                        styleClass="p-button-rounded p-button-primary p-button-text"
                    ></p-button>
                    <strong>{{ answer.votes }}</strong>
                    <p-button icon="pi pi-angle-down" 
                        [disabled]="!isLoggedIn"
                        styleClass="p-button-rounded p-button-danger p-button-text"
                    ></p-button>
                </div>
                <div class="question__content">
                    <div class="question__header">
                        <p>Answered by {{ answer.user.name}} at {{ question.createdAt | date:'dd/MM/yyyy' }}</p>
                        <div *ngIf="isOwner(answer.user._id)">
                            <p-button
                                *ngIf="editingAnswerIndex != index"
                                (onClick)="editingAnswerIndex = index"
                                icon="pi pi-pencil"
                                styleClass="p-button-primary p-button-text"
                            ></p-button>
                            <p-button
                                *ngIf="editingAnswerIndex == index"
                                (onClick)="editAnswer(answer._id)"
                                icon="pi pi-check"
                                styleClass="p-button-primary p-button-text"
                            ></p-button>
                            <p-button
                                (onClick)="deleteAnswer(answer._id)"
                                icon="pi pi-trash"
                                styleClass="p-button-danger p-button-text"
                            ></p-button>
                        </div>
                    </div>
                    <p-divider></p-divider>
                    <p *ngIf="editingAnswerIndex != index" class="question__content__text" [innerHTML]="answer.content"></p>
                    <p-editor *ngIf="editingAnswerIndex == index" [(ngModel)]="answer.content" [style]="{ height: '320px' }"></p-editor>
                </div>
            </div>
        </ng-template>
    </p-dataView>

    <form class="question__card write" *ngIf="isLoggedIn" (submit)="sendAnswer()">
        <div class="question__content">
            <h3>Write your answer:</h3>
            <div class="question__editor">
                <p-editor [(ngModel)]="answer" name="editor" [style]="{ height: '320px' }"></p-editor>
            </div>
            <p-button
                type="submit"
                label="Submit"
                [loading]="loading"
                styleClass="p-button-success"
            ></p-button>
        </div>
    </form>
</div>


<p-toast></p-toast>